{"version":3,"file":"index.js","names":["targetPath: string","severity: string","checkId: string","verbose: boolean","data: Buffer","framework: string | undefined","tfsecResult: TfsecResult","scanPath: string","findings: IacFinding[]","checkovResults: CheckovResult[]","result: ScanResult","options: CliOptions","scanner: ScannerType | null"],"sources":["../src/index.ts"],"sourcesContent":["#!/usr/bin/env node\n\nimport { spawn, spawnSync } from \"node:child_process\";\nimport { existsSync } from \"node:fs\";\nimport { join } from \"node:path\";\nimport { parseArgs } from \"node:util\";\nimport type {\n  CheckovResult,\n  CliOptions,\n  IacFinding,\n  ScanResult,\n  ScannerType,\n  TfsecResult,\n} from \"./types.js\";\n\nfunction checkTfsecInstalled(): boolean {\n  try {\n    const result = spawnSync(\"tfsec\", [\"--version\"], {\n      encoding: \"utf-8\",\n      stdio: [\"pipe\", \"pipe\", \"pipe\"],\n    });\n    return result.status === 0;\n  } catch {\n    return false;\n  }\n}\n\nfunction checkCheckovInstalled(): boolean {\n  try {\n    const result = spawnSync(\"checkov\", [\"--version\"], {\n      encoding: \"utf-8\",\n      stdio: [\"pipe\", \"pipe\", \"pipe\"],\n    });\n    return result.status === 0;\n  } catch {\n    return false;\n  }\n}\n\nfunction getTfsecVersion(): string {\n  try {\n    const result = spawnSync(\"tfsec\", [\"--version\"], {\n      encoding: \"utf-8\",\n      stdio: [\"pipe\", \"pipe\", \"pipe\"],\n    });\n    return result.stdout?.trim() || \"unknown\";\n  } catch {\n    return \"unknown\";\n  }\n}\n\nfunction getCheckovVersion(): string {\n  try {\n    const result = spawnSync(\"checkov\", [\"--version\"], {\n      encoding: \"utf-8\",\n      stdio: [\"pipe\", \"pipe\", \"pipe\"],\n    });\n    return result.stdout?.trim() || \"unknown\";\n  } catch {\n    return \"unknown\";\n  }\n}\n\nfunction detectScanner(targetPath: string): ScannerType | null {\n  // Check for Terraform files\n  const hasTerraform =\n    existsSync(join(targetPath, \"main.tf\")) ||\n    existsSync(join(targetPath, \"terraform.tf\"));\n\n  // Check for other IaC files\n  const hasCloudFormation =\n    existsSync(join(targetPath, \"template.yaml\")) ||\n    existsSync(join(targetPath, \"template.json\"));\n\n  const hasKubernetes =\n    existsSync(join(targetPath, \"deployment.yaml\")) ||\n    existsSync(join(targetPath, \"k8s\"));\n\n  // Prefer tfsec for pure Terraform, Checkov for mixed\n  if (hasTerraform && !hasCloudFormation && !hasKubernetes) {\n    if (checkTfsecInstalled()) return \"tfsec\";\n  }\n\n  // Use Checkov for multi-framework or if tfsec unavailable\n  if (checkCheckovInstalled()) return \"checkov\";\n  if (checkTfsecInstalled()) return \"tfsec\";\n\n  return null;\n}\n\nfunction mapTfsecSeverity(\n  severity: string\n): \"critical\" | \"high\" | \"medium\" | \"low\" | \"info\" {\n  switch (severity.toUpperCase()) {\n    case \"CRITICAL\":\n      return \"critical\";\n    case \"HIGH\":\n      return \"high\";\n    case \"MEDIUM\":\n      return \"medium\";\n    case \"LOW\":\n      return \"low\";\n    default:\n      return \"info\";\n  }\n}\n\nfunction mapCheckovSeverity(\n  checkId: string\n): \"critical\" | \"high\" | \"medium\" | \"low\" | \"info\" {\n  // Checkov doesn't provide severity directly, estimate from check ID patterns\n  if (checkId.includes(\"CRITICAL\")) return \"critical\";\n  if (\n    checkId.includes(\"encryption\") ||\n    checkId.includes(\"public\") ||\n    checkId.includes(\"secret\")\n  ) {\n    return \"high\";\n  }\n  if (checkId.includes(\"logging\") || checkId.includes(\"backup\")) {\n    return \"medium\";\n  }\n  return \"medium\"; // Default to medium for IaC misconfigurations\n}\n\nasync function runTfsec(\n  targetPath: string,\n  verbose: boolean\n): Promise<TfsecResult> {\n  return new Promise((resolve, reject) => {\n    const args = [\"--format\", \"json\", targetPath];\n\n    if (verbose) {\n      console.error(`Running: tfsec ${args.join(\" \")}`);\n    }\n\n    const proc = spawn(\"tfsec\", args, {\n      stdio: [\"pipe\", \"pipe\", \"pipe\"],\n    });\n\n    let stdout = \"\";\n    let stderr = \"\";\n\n    proc.stdout.on(\"data\", (data: Buffer) => {\n      stdout += data.toString();\n    });\n\n    proc.stderr.on(\"data\", (data: Buffer) => {\n      stderr += data.toString();\n    });\n\n    proc.on(\"close\", (code) => {\n      // tfsec exits with non-zero when issues found\n      try {\n        const result = JSON.parse(stdout) as TfsecResult;\n        resolve(result);\n      } catch (e) {\n        reject(new Error(`Failed to parse tfsec output: ${e}\\n${stderr}`));\n      }\n    });\n\n    proc.on(\"error\", (err) => {\n      reject(new Error(`Failed to spawn tfsec: ${err.message}`));\n    });\n  });\n}\n\nasync function runCheckov(\n  targetPath: string,\n  framework: string | undefined,\n  verbose: boolean\n): Promise<CheckovResult[]> {\n  return new Promise((resolve, reject) => {\n    const args = [\"-d\", targetPath, \"-o\", \"json\", \"--compact\"];\n\n    if (framework) {\n      args.push(\"--framework\", framework);\n    }\n\n    if (verbose) {\n      console.error(`Running: checkov ${args.join(\" \")}`);\n    }\n\n    const proc = spawn(\"checkov\", args, {\n      stdio: [\"pipe\", \"pipe\", \"pipe\"],\n    });\n\n    let stdout = \"\";\n    let stderr = \"\";\n\n    proc.stdout.on(\"data\", (data: Buffer) => {\n      stdout += data.toString();\n    });\n\n    proc.stderr.on(\"data\", (data: Buffer) => {\n      stderr += data.toString();\n    });\n\n    proc.on(\"close\", (code) => {\n      // checkov exits with non-zero when issues found\n      try {\n        if (stdout.trim()) {\n          // Checkov outputs array of results\n          const parsed = JSON.parse(stdout);\n          const results = Array.isArray(parsed) ? parsed : [parsed];\n          resolve(results as CheckovResult[]);\n        } else {\n          resolve([]);\n        }\n      } catch (e) {\n        reject(new Error(`Failed to parse checkov output: ${e}\\n${stderr}`));\n      }\n    });\n\n    proc.on(\"error\", (err) => {\n      reject(new Error(`Failed to spawn checkov: ${err.message}`));\n    });\n  });\n}\n\nfunction transformTfsecResult(\n  tfsecResult: TfsecResult,\n  scanPath: string\n): ScanResult {\n  const findings: IacFinding[] = (tfsecResult.results || []).map((f) => ({\n    id: f.long_id || f.rule_id,\n    severity: mapTfsecSeverity(f.severity),\n    message: f.description || f.rule_description,\n    resource: f.resource,\n    file: f.location.filename,\n    line: f.location.start_line,\n    endLine: f.location.end_line,\n    resolution: f.resolution,\n    impact: f.impact,\n    references: f.links || [],\n  }));\n\n  return {\n    tool: \"tfsec\",\n    version: getTfsecVersion(),\n    scanPath,\n    scanDate: new Date().toISOString(),\n    framework: \"terraform\",\n    findings,\n    summary: {\n      total: findings.length,\n      critical: findings.filter((f) => f.severity === \"critical\").length,\n      high: findings.filter((f) => f.severity === \"high\").length,\n      medium: findings.filter((f) => f.severity === \"medium\").length,\n      low: findings.filter((f) => f.severity === \"low\").length,\n      info: findings.filter((f) => f.severity === \"info\").length,\n    },\n  };\n}\n\nfunction transformCheckovResult(\n  checkovResults: CheckovResult[],\n  scanPath: string\n): ScanResult {\n  const findings: IacFinding[] = [];\n  let totalPassed = 0;\n  let totalSkipped = 0;\n\n  for (const result of checkovResults) {\n    totalPassed += result.summary.passed;\n    totalSkipped += result.summary.skipped;\n\n    for (const check of result.results.failed_checks) {\n      findings.push({\n        id: check.check_id,\n        severity: mapCheckovSeverity(check.check_id),\n        message: check.check_name,\n        resource: check.resource,\n        file: check.file_path,\n        line: check.file_line_range[0],\n        endLine: check.file_line_range[1],\n        resolution: check.guideline,\n        references: check.guideline ? [check.guideline] : [],\n      });\n    }\n  }\n\n  return {\n    tool: \"checkov\",\n    version: getCheckovVersion(),\n    scanPath,\n    scanDate: new Date().toISOString(),\n    findings,\n    summary: {\n      total: findings.length,\n      critical: findings.filter((f) => f.severity === \"critical\").length,\n      high: findings.filter((f) => f.severity === \"high\").length,\n      medium: findings.filter((f) => f.severity === \"medium\").length,\n      low: findings.filter((f) => f.severity === \"low\").length,\n      info: findings.filter((f) => f.severity === \"info\").length,\n      passed: totalPassed,\n      skipped: totalSkipped,\n    },\n  };\n}\n\nfunction printTextReport(result: ScanResult): void {\n  console.log(\"\\n=== IaC Security Scan Report ===\\n\");\n  console.log(`Tool: ${result.tool} (${result.version})`);\n  console.log(`Scan Path: ${result.scanPath}`);\n  if (result.framework) {\n    console.log(`Framework: ${result.framework}`);\n  }\n  console.log(`Date: ${result.scanDate}`);\n  console.log(\"\\n--- Summary ---\");\n  console.log(`Total Issues: ${result.summary.total}`);\n  console.log(`  Critical: ${result.summary.critical}`);\n  console.log(`  High: ${result.summary.high}`);\n  console.log(`  Medium: ${result.summary.medium}`);\n  console.log(`  Low: ${result.summary.low}`);\n  console.log(`  Info: ${result.summary.info}`);\n  if (result.summary.passed !== undefined) {\n    console.log(`  Passed: ${result.summary.passed}`);\n  }\n\n  if (result.findings.length > 0) {\n    console.log(\"\\n--- Misconfigurations ---\\n\");\n\n    const severityOrder = { critical: 0, high: 1, medium: 2, low: 3, info: 4 };\n    const sorted = [...result.findings].sort(\n      (a, b) => severityOrder[a.severity] - severityOrder[b.severity]\n    );\n\n    for (const finding of sorted) {\n      console.log(`[${finding.severity.toUpperCase()}] ${finding.id}`);\n      console.log(`  Resource: ${finding.resource}`);\n      console.log(`  File: ${finding.file}:${finding.line}`);\n      console.log(`  Issue: ${finding.message}`);\n      if (finding.resolution) {\n        console.log(`  Resolution: ${finding.resolution}`);\n      }\n      console.log(\"\");\n    }\n  } else {\n    console.log(\"\\nNo misconfigurations found.\");\n  }\n}\n\nfunction printHelp(): void {\n  console.log(`\niac-scanner - Infrastructure as Code Security Scanner\n\nUsage:\n  iac-scanner <path> [options]\n  iac-scanner --check\n\nOptions:\n  --scanner, -s <type>   Scanner: auto, tfsec, checkov (default: auto)\n  --framework, -f <type> Framework: terraform, kubernetes, cloudformation\n  --json, -j             Output as JSON\n  --verbose, -v          Verbose output\n  --check                Check available scanners\n  --help, -h             Show this help\n\nExamples:\n  iac-scanner .                          # Auto-detect scanner\n  iac-scanner . --scanner tfsec          # Use tfsec\n  iac-scanner . --scanner checkov        # Use checkov\n  iac-scanner . --framework kubernetes   # Scan Kubernetes manifests\n  iac-scanner . --json                   # JSON output\n`);\n}\n\nasync function main(): Promise<void> {\n  const { values, positionals } = parseArgs({\n    allowPositionals: true,\n    options: {\n      scanner: { type: \"string\", short: \"s\", default: \"auto\" },\n      framework: { type: \"string\", short: \"f\" },\n      json: { type: \"boolean\", short: \"j\", default: false },\n      verbose: { type: \"boolean\", short: \"v\", default: false },\n      check: { type: \"boolean\", default: false },\n      help: { type: \"boolean\", short: \"h\", default: false },\n    },\n  });\n\n  if (values.help) {\n    printHelp();\n    process.exit(0);\n  }\n\n  if (values.check) {\n    console.log(\"Available scanners:\");\n    console.log(`  tfsec: ${checkTfsecInstalled() ? \"installed\" : \"not found\"}`);\n    console.log(`  checkov: ${checkCheckovInstalled() ? \"installed\" : \"not found\"}`);\n\n    if (!checkTfsecInstalled() && !checkCheckovInstalled()) {\n      console.error(\"\\nNo scanners available. Install one of:\");\n      console.error(\"  tfsec: brew install tfsec\");\n      console.error(\"  checkov: pip install checkov\");\n      process.exit(2);\n    }\n    process.exit(0);\n  }\n\n  const targetPath = positionals[0] || \".\";\n\n  const options: CliOptions = {\n    path: targetPath,\n    scanner: (values.scanner || \"auto\") as \"auto\" | \"tfsec\" | \"checkov\",\n    framework: values.framework,\n    json: values.json || false,\n    check: values.check || false,\n    verbose: values.verbose || false,\n  };\n\n  let scanner: ScannerType | null = null;\n\n  if (options.scanner === \"auto\") {\n    scanner = detectScanner(targetPath);\n    if (!scanner) {\n      console.error(\"Error: No suitable scanner found.\");\n      console.error(\"Run 'iac-scanner --check' to see available scanners.\");\n      process.exit(2);\n    }\n  } else if (options.scanner === \"tfsec\") {\n    if (!checkTfsecInstalled()) {\n      console.error(\"Error: tfsec is not installed.\");\n      console.error(\"Install with: brew install tfsec\");\n      process.exit(2);\n    }\n    scanner = \"tfsec\";\n  } else if (options.scanner === \"checkov\") {\n    if (!checkCheckovInstalled()) {\n      console.error(\"Error: checkov is not installed.\");\n      console.error(\"Install with: pip install checkov\");\n      process.exit(2);\n    }\n    scanner = \"checkov\";\n  }\n\n  try {\n    let result: ScanResult;\n\n    if (scanner === \"tfsec\") {\n      const tfsecResult = await runTfsec(targetPath, options.verbose);\n      result = transformTfsecResult(tfsecResult, targetPath);\n    } else {\n      const checkovResult = await runCheckov(\n        targetPath,\n        options.framework,\n        options.verbose\n      );\n      result = transformCheckovResult(checkovResult, targetPath);\n    }\n\n    if (options.json) {\n      console.log(JSON.stringify(result, null, 2));\n    } else {\n      printTextReport(result);\n    }\n\n    if (result.summary.total > 0) {\n      process.exit(1);\n    }\n    process.exit(0);\n  } catch (error) {\n    console.error(\n      `Error: ${error instanceof Error ? error.message : String(error)}`\n    );\n    process.exit(2);\n  }\n}\n\nmain();\n"],"mappings":"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"}