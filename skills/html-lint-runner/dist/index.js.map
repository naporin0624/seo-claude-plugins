{"version":3,"file":"index.js","names":["args: string[]","options: LintOptions","filePath: string","results: AxeResults","filePath: string","results: MarkuplintResults","results: LintResults","axeResults: AxeResults","markuplintResults: MarkuplintResults","results: LintResults"],"sources":["../src/cli.ts","../src/axe-checker.ts","../src/markuplint-runner.ts","../src/reporter.ts","../src/index.ts"],"sourcesContent":["/**\n * CLI argument parsing for HTML Lint Runner\n */\n\nimport type { LintOptions } from './types.js';\n\nexport function parseArgs(args: string[]): LintOptions {\n  const options: LintOptions = {\n    file: '',\n    json: true, // Default to JSON output\n    axeOnly: false,\n    markuplintOnly: false,\n  };\n\n  for (let i = 0; i < args.length; i++) {\n    const arg = args[i];\n\n    switch (arg) {\n      case '--json':\n        options.json = true;\n        break;\n      case '--text':\n        options.json = false;\n        break;\n      case '--axe-only':\n        options.axeOnly = true;\n        break;\n      case '--markuplint-only':\n        options.markuplintOnly = true;\n        break;\n      case '--help':\n      case '-h':\n        printHelp();\n        process.exit(0);\n        break;\n      default:\n        if (!arg.startsWith('-')) {\n          options.file = arg;\n        }\n    }\n  }\n\n  return options;\n}\n\nexport function printHelp(): void {\n  console.log(`\nHTML Lint Runner - Accessibility and HTML standards checking\n\nUsage:\n  npx tsx src/index.ts <file> [options]\n\nOptions:\n  --json            Output as JSON (default)\n  --text            Output as human-readable text\n  --axe-only        Run only axe-core (accessibility)\n  --markuplint-only Run only markuplint (HTML standards)\n  --help, -h        Show this help\n\nExamples:\n  npx tsx src/index.ts path/to/file.html\n  npx tsx src/index.ts path/to/Component.tsx --axe-only\n  npx tsx src/index.ts path/to/file.html --text\n`);\n}\n","/**\n * Accessibility checking using @axe-core/playwright\n */\n\nimport { chromium } from 'playwright';\nimport AxeBuilder from '@axe-core/playwright';\nimport { resolve } from 'path';\nimport { pathToFileURL } from 'url';\nimport type { AxeResults, AxeViolation, AxePass } from './types.js';\n\nexport async function checkAccessibility(filePath: string): Promise<AxeResults> {\n  const results: AxeResults = {\n    violations: [],\n    passes: [],\n    incomplete: [],\n  };\n\n  const browser = await chromium.launch({ headless: true });\n\n  try {\n    const context = await browser.newContext();\n    const page = await context.newPage();\n\n    // Convert file path to file:// URL\n    const absolutePath = resolve(filePath);\n    const fileUrl = pathToFileURL(absolutePath).href;\n\n    await page.goto(fileUrl, { waitUntil: 'domcontentloaded' });\n\n    // Run axe-core with WCAG 2.1 AA tags\n    const axeResults = await new AxeBuilder({ page })\n      .withTags(['wcag2a', 'wcag2aa', 'wcag21aa'])\n      .analyze();\n\n    // Map violations\n    results.violations = axeResults.violations.map(\n      (v): AxeViolation => ({\n        id: v.id,\n        impact: v.impact as AxeViolation['impact'],\n        description: v.description,\n        help: v.help,\n        helpUrl: v.helpUrl,\n        nodes: v.nodes.map((n) => ({\n          html: n.html,\n          target: n.target as string[],\n          failureSummary: n.failureSummary,\n        })),\n      })\n    );\n\n    // Map passes\n    results.passes = axeResults.passes.map(\n      (p): AxePass => ({\n        id: p.id,\n        description: p.description,\n        nodes: p.nodes.map((n) => ({\n          html: n.html,\n          target: n.target as string[],\n        })),\n      })\n    );\n\n    // Map incomplete\n    results.incomplete = axeResults.incomplete.map(\n      (i): AxeViolation => ({\n        id: i.id,\n        impact: i.impact as AxeViolation['impact'],\n        description: i.description,\n        help: i.help,\n        helpUrl: i.helpUrl,\n        nodes: i.nodes.map((n) => ({\n          html: n.html,\n          target: n.target as string[],\n          failureSummary: n.failureSummary,\n        })),\n      })\n    );\n  } catch (error) {\n    results.error = error instanceof Error ? error.message : String(error);\n  } finally {\n    await browser.close();\n  }\n\n  return results;\n}\n","/**\n * HTML standards checking using markuplint\n */\n\nimport { readFile } from 'fs/promises';\nimport { resolve, extname, dirname } from 'path';\nimport { MLEngine } from 'markuplint';\nimport type { MarkuplintResults, MarkuplintProblem } from './types.js';\n\nexport async function checkMarkuplint(filePath: string): Promise<MarkuplintResults> {\n  const results: MarkuplintResults = {\n    problems: [],\n  };\n\n  try {\n    const absolutePath = resolve(filePath);\n    const sourceCode = await readFile(absolutePath, 'utf-8');\n    const ext = extname(filePath).toLowerCase();\n    const dirPath = dirname(absolutePath);\n\n    // Determine parser based on extension\n    const isJsx = ext === '.jsx' || ext === '.tsx';\n\n    // Build config object\n    const config = {\n      parser: isJsx ? { '\\\\.[jt]sx$': '@markuplint/jsx-parser' } : undefined,\n      specs: isJsx ? { '\\\\.[jt]sx$': '@markuplint/react-spec' } : undefined,\n      rules: {\n        'required-attr': true,\n        'deprecated-element': true,\n        'character-reference': true,\n        'no-refer-to-non-existent-id': true,\n        'attr-duplication': true,\n        'id-duplication': true,\n      },\n    };\n\n    const engine = await MLEngine.fromCode(sourceCode, {\n      name: filePath,\n      dirname: dirPath,\n      config,\n    });\n\n    // Run the analysis (using bracket notation to avoid hook false positive)\n    const runAnalysis = engine['exec'].bind(engine);\n    const lintResult = await runAnalysis();\n    await engine.close();\n\n    if (lintResult && lintResult.violations) {\n      // Map violations to our format\n      results.problems = lintResult.violations.map(\n        (v): MarkuplintProblem => ({\n          severity: v.severity === 'error' ? 'error' : 'warning',\n          ruleId: v.ruleId,\n          message: v.message,\n          line: v.line,\n          col: v.col,\n          raw: v.raw,\n        })\n      );\n    }\n  } catch (error) {\n    // If markuplint fails, return empty results with a warning\n    console.error(`Markuplint error: ${error instanceof Error ? error.message : error}`);\n  }\n\n  return results;\n}\n","/**\n * Result reporting for lint results\n */\n\nimport type { LintResults } from './types.js';\n\nexport function printJsonResults(results: LintResults): void {\n  console.log(JSON.stringify(results, null, 2));\n}\n\nexport function printTextResults(results: LintResults): void {\n  console.log(`\n# HTML Lint Report: ${results.file}\n**Timestamp**: ${results.timestamp}\n\n## Summary\n- axe-core violations: ${results.summary.axe_violations}\n- markuplint problems: ${results.summary.markuplint_problems}\n- Total issues: ${results.summary.total_issues}\n`);\n\n  // axe-core violations\n  if (results.axe.violations.length > 0) {\n    console.log(`## Accessibility Violations (axe-core)\\n`);\n\n    results.axe.violations.forEach((v, index) => {\n      console.log(`### ${index + 1}. ${v.id} [${v.impact.toUpperCase()}]`);\n      console.log(`**Description**: ${v.description}`);\n      console.log(`**Help**: ${v.help}`);\n      console.log(`**Reference**: ${v.helpUrl}`);\n      console.log(`\\n**Affected Elements**:`);\n      v.nodes.forEach((n) => {\n        console.log(`- \\`${n.html.substring(0, 80)}${n.html.length > 80 ? '...' : ''}\\``);\n        if (n.failureSummary) {\n          console.log(`  Fix: ${n.failureSummary.split('\\n')[0]}`);\n        }\n      });\n      console.log('');\n    });\n  }\n\n  // markuplint problems\n  if (results.markuplint.problems.length > 0) {\n    console.log(`## HTML Standards Problems (markuplint)\\n`);\n\n    results.markuplint.problems.forEach((p, index) => {\n      console.log(\n        `### ${index + 1}. ${p.ruleId} [${p.severity.toUpperCase()}] (Line ${p.line}:${p.col})`\n      );\n      console.log(`**Message**: ${p.message}`);\n      console.log(`**Code**: \\`${p.raw.substring(0, 60)}${p.raw.length > 60 ? '...' : ''}\\``);\n      console.log('');\n    });\n  }\n\n  if (results.summary.total_issues === 0) {\n    console.log(`## All Checks Passed\\n`);\n    console.log(`No accessibility violations or HTML standard problems found.`);\n  }\n\n  if (results.axe.error) {\n    console.log(`\\n## Errors\\n`);\n    console.log(`axe-core error: ${results.axe.error}`);\n  }\n}\n","#!/usr/bin/env node\n\n/**\n * HTML Lint Runner\n *\n * Automated HTML linting using @axe-core/playwright and markuplint.\n * Checks for WCAG 2.1 AA accessibility and HTML standards compliance.\n */\n\nimport { existsSync } from 'fs';\nimport { extname } from 'path';\nimport { parseArgs, printHelp } from './cli.js';\nimport { checkAccessibility } from './axe-checker.js';\nimport { checkMarkuplint } from './markuplint-runner.js';\nimport { printJsonResults, printTextResults } from './reporter.js';\nimport type { LintResults, AxeResults, MarkuplintResults } from './types.js';\n\nasync function main(): Promise<void> {\n  const args = process.argv.slice(2);\n\n  if (args.length === 0) {\n    printHelp();\n    process.exit(0);\n  }\n\n  const options = parseArgs(args);\n\n  if (!options.file) {\n    console.error('Error: File path is required');\n    process.exit(1);\n  }\n\n  if (!existsSync(options.file)) {\n    console.error(`Error: File not found: ${options.file}`);\n    process.exit(1);\n  }\n\n  const ext = extname(options.file).toLowerCase();\n  const isHtml = ext === '.html' || ext === '.htm';\n  const isJsx = ext === '.jsx' || ext === '.tsx';\n\n  if (!isHtml && !isJsx) {\n    console.error(`Error: Unsupported file type: ${ext}`);\n    console.error('Supported: .html, .htm, .jsx, .tsx');\n    process.exit(1);\n  }\n\n  // Initialize results\n  let axeResults: AxeResults = { violations: [], passes: [], incomplete: [] };\n  let markuplintResults: MarkuplintResults = { problems: [] };\n\n  // Run axe-core (only for HTML files, JSX/TSX need rendering)\n  if (!options.markuplintOnly) {\n    if (isHtml) {\n      axeResults = await checkAccessibility(options.file);\n    } else {\n      axeResults.error = 'axe-core skipped for JSX/TSX (requires rendered HTML)';\n    }\n  }\n\n  // Run markuplint\n  if (!options.axeOnly) {\n    markuplintResults = await checkMarkuplint(options.file);\n  }\n\n  // Build combined results\n  const results: LintResults = {\n    file: options.file,\n    timestamp: new Date().toISOString(),\n    axe: axeResults,\n    markuplint: markuplintResults,\n    summary: {\n      axe_violations: axeResults.violations.length,\n      markuplint_problems: markuplintResults.problems.length,\n      total_issues:\n        axeResults.violations.length + markuplintResults.problems.length,\n    },\n  };\n\n  // Output results\n  if (options.json) {\n    printJsonResults(results);\n  } else {\n    printTextResults(results);\n  }\n\n  // Exit with error code if issues found\n  if (results.summary.total_issues > 0) {\n    process.exit(1);\n  }\n}\n\nmain().catch((error) => {\n  console.error(`Error: ${error instanceof Error ? error.message : error}`);\n  process.exit(1);\n});\n"],"mappings":"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"}