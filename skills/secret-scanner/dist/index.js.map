{"version":3,"file":"index.js","names":["SEVERITY_MAP: Record<string, 'critical' | 'high' | 'medium' | 'low'>","CWE_MAP: Record<string, string[]>","args: string[]","options: CliOptions","ruleId: string","secret: string","gitleaksFindings: GitleaksFinding[]","findings: SecretFinding[]","scanPath: string","data: Buffer","result: ScanResult","lines: string[]"],"sources":["../src/types.ts","../src/index.ts"],"sourcesContent":["export interface GitleaksFinding {\n  Description: string;\n  StartLine: number;\n  EndLine: number;\n  StartColumn: number;\n  EndColumn: number;\n  Match: string;\n  Secret: string;\n  File: string;\n  SymlinkFile: string;\n  Commit: string;\n  Entropy: number;\n  Author: string;\n  Email: string;\n  Date: string;\n  Message: string;\n  Tags: string[];\n  RuleID: string;\n  Fingerprint: string;\n}\n\nexport interface SecretFinding {\n  id: string;\n  severity: 'critical' | 'high' | 'medium' | 'low';\n  description: string;\n  file: string;\n  line: number;\n  secret: string;\n  commit: string;\n  author: string;\n  date: string;\n  cwes: string[];\n}\n\nexport interface ScanResult {\n  tool: string;\n  version: string;\n  scanPath: string;\n  scanDate: string;\n  findings: SecretFinding[];\n  summary: {\n    total: number;\n    critical: number;\n    high: number;\n    medium: number;\n    low: number;\n  };\n}\n\nexport interface CliOptions {\n  path: string;\n  json: boolean;\n  check: boolean;\n  verbose: boolean;\n}\n\nexport const SEVERITY_MAP: Record<string, 'critical' | 'high' | 'medium' | 'low'> = {\n  // Critical - Direct access to cloud/infrastructure\n  'aws-access-key-id': 'critical',\n  'aws-secret-access-key': 'critical',\n  'gcp-api-key': 'critical',\n  'azure-storage-key': 'critical',\n  'private-key': 'critical',\n  'ssh-private-key': 'critical',\n  'rsa-private-key': 'critical',\n\n  // High - Authentication credentials\n  'password': 'high',\n  'api-key': 'high',\n  'github-pat': 'high',\n  'gitlab-pat': 'high',\n  'npm-access-token': 'high',\n  'slack-token': 'high',\n  'stripe-api-key': 'high',\n  'twilio-api-key': 'high',\n  'sendgrid-api-key': 'high',\n  'mailchimp-api-key': 'high',\n\n  // Medium - Tokens and secrets\n  'generic-api-key': 'medium',\n  'jwt': 'medium',\n  'oauth-token': 'medium',\n  'bearer-token': 'medium',\n\n  // Low - Generic patterns\n  'generic-credential': 'low',\n  'password-in-url': 'low',\n};\n\nexport const CWE_MAP: Record<string, string[]> = {\n  critical: ['CWE-798', 'CWE-321'],\n  high: ['CWE-798', 'CWE-259'],\n  medium: ['CWE-312'],\n  low: ['CWE-312'],\n};\n","#!/usr/bin/env node\n\nimport { spawn, spawnSync } from \"child_process\";\nimport { existsSync } from \"fs\";\nimport type {\n  GitleaksFinding,\n  SecretFinding,\n  ScanResult,\n  CliOptions,\n} from \"./types.js\";\nimport { SEVERITY_MAP, CWE_MAP } from \"./types.js\";\n\nfunction parseArgs(args: string[]): CliOptions {\n  const options: CliOptions = {\n    path: \".\",\n    json: false,\n    check: false,\n    verbose: false,\n  };\n\n  for (let i = 0; i < args.length; i++) {\n    const arg = args[i];\n    if (arg === \"--json\" || arg === \"-j\") {\n      options.json = true;\n    } else if (arg === \"--check\" || arg === \"-c\") {\n      options.check = true;\n    } else if (arg === \"--verbose\" || arg === \"-v\") {\n      options.verbose = true;\n    } else if (arg === \"--help\" || arg === \"-h\") {\n      printHelp();\n      process.exit(0);\n    } else if (!arg.startsWith(\"-\")) {\n      options.path = arg;\n    }\n  }\n\n  return options;\n}\n\nfunction printHelp(): void {\n  console.log(`\nSecret Scanner - Gitleaks Wrapper\n\nUsage: secret-scanner [path] [options]\n\nArguments:\n  path          Path to scan (default: current directory)\n\nOptions:\n  --json, -j    Output results as JSON\n  --check, -c   Check if gitleaks is installed\n  --verbose, -v Show detailed output\n  --help, -h    Show this help message\n\nExamples:\n  secret-scanner .                    # Scan current directory\n  secret-scanner /path/to/repo --json # Scan with JSON output\n  secret-scanner --check              # Check gitleaks installation\n`);\n}\n\nfunction checkGitleaksInstalled(): boolean {\n  const result = spawnSync(\"gitleaks\", [\"version\"], { stdio: \"pipe\" });\n  return result.status === 0;\n}\n\nfunction getGitleaksVersion(): string {\n  const result = spawnSync(\"gitleaks\", [\"version\"], { encoding: \"utf-8\" });\n  if (result.status === 0 && result.stdout) {\n    return result.stdout.toString().trim();\n  }\n  return \"unknown\";\n}\n\nfunction getSeverity(ruleId: string): \"critical\" | \"high\" | \"medium\" | \"low\" {\n  const normalizedRule = ruleId.toLowerCase().replace(/_/g, \"-\");\n\n  // Check exact match first\n  if (SEVERITY_MAP[normalizedRule]) {\n    return SEVERITY_MAP[normalizedRule];\n  }\n\n  // Check partial matches\n  for (const [key, severity] of Object.entries(SEVERITY_MAP)) {\n    if (normalizedRule.includes(key) || key.includes(normalizedRule)) {\n      return severity;\n    }\n  }\n\n  // Default to medium for unknown rules\n  return \"medium\";\n}\n\nfunction redactSecret(secret: string): string {\n  if (secret.length <= 8) {\n    return \"***REDACTED***\";\n  }\n  return secret.slice(0, 4) + \"***REDACTED***\" + secret.slice(-4);\n}\n\nfunction transformFindings(gitleaksFindings: GitleaksFinding[]): SecretFinding[] {\n  return gitleaksFindings.map((finding) => {\n    const severity = getSeverity(finding.RuleID);\n    return {\n      id: finding.RuleID,\n      severity,\n      description: finding.Description,\n      file: finding.File,\n      line: finding.StartLine,\n      secret: redactSecret(finding.Secret),\n      commit: finding.Commit?.slice(0, 7) || \"staged\",\n      author: finding.Email || \"unknown\",\n      date: finding.Date || new Date().toISOString(),\n      cwes: CWE_MAP[severity] || [],\n    };\n  });\n}\n\nfunction calculateSummary(findings: SecretFinding[]): ScanResult[\"summary\"] {\n  return findings.reduce(\n    (acc, finding) => {\n      acc.total++;\n      acc[finding.severity]++;\n      return acc;\n    },\n    { total: 0, critical: 0, high: 0, medium: 0, low: 0 }\n  );\n}\n\nasync function runGitleaks(scanPath: string): Promise<GitleaksFinding[]> {\n  return new Promise((resolve, reject) => {\n    const args = [\"detect\", \"--source\", scanPath, \"-v\", \"--report-format\", \"json\"];\n\n    const proc = spawn(\"gitleaks\", args, {\n      stdio: [\"pipe\", \"pipe\", \"pipe\"],\n    });\n\n    let stdout = \"\";\n    let stderr = \"\";\n\n    proc.stdout.on(\"data\", (data: Buffer) => {\n      stdout += data.toString();\n    });\n\n    proc.stderr.on(\"data\", (data: Buffer) => {\n      stderr += data.toString();\n    });\n\n    proc.on(\"close\", (code) => {\n      // Exit code 1 means leaks were found (not an error)\n      if (code === 0) {\n        resolve([]);\n      } else if (code === 1) {\n        try {\n          const findings = JSON.parse(stdout) as GitleaksFinding[];\n          resolve(findings);\n        } catch {\n          // If JSON parsing fails, try to extract from stderr\n          console.error(\"Warning: Could not parse gitleaks output\");\n          resolve([]);\n        }\n      } else {\n        reject(new Error(`Gitleaks exited with code ${code}: ${stderr}`));\n      }\n    });\n\n    proc.on(\"error\", (err) => {\n      reject(new Error(`Failed to run gitleaks: ${err.message}`));\n    });\n  });\n}\n\nfunction formatTextOutput(result: ScanResult): string {\n  const lines: string[] = [];\n\n  lines.push(\"=\".repeat(60));\n  lines.push(\"Secret Scanner Report\");\n  lines.push(\"=\".repeat(60));\n  lines.push(`Scan Path: ${result.scanPath}`);\n  lines.push(`Scan Date: ${result.scanDate}`);\n  lines.push(`Tool: ${result.tool} ${result.version}`);\n  lines.push(\"\");\n\n  lines.push(\"Summary:\");\n  lines.push(`  Total: ${result.summary.total}`);\n  lines.push(`  Critical: ${result.summary.critical}`);\n  lines.push(`  High: ${result.summary.high}`);\n  lines.push(`  Medium: ${result.summary.medium}`);\n  lines.push(`  Low: ${result.summary.low}`);\n  lines.push(\"\");\n\n  if (result.findings.length === 0) {\n    lines.push(\"No secrets found.\");\n  } else {\n    lines.push(\"Findings:\");\n    lines.push(\"-\".repeat(60));\n\n    for (const finding of result.findings) {\n      lines.push(`[${finding.severity.toUpperCase()}] ${finding.description}`);\n      lines.push(`  File: ${finding.file}:${finding.line}`);\n      lines.push(`  Rule: ${finding.id}`);\n      lines.push(`  Secret: ${finding.secret}`);\n      lines.push(`  Commit: ${finding.commit}`);\n      lines.push(`  CWEs: ${finding.cwes.join(\", \")}`);\n      lines.push(\"\");\n    }\n  }\n\n  return lines.join(\"\\n\");\n}\n\nasync function main(): Promise<void> {\n  const args = process.argv.slice(2);\n  const options = parseArgs(args);\n\n  // Check mode\n  if (options.check) {\n    const installed = checkGitleaksInstalled();\n    if (installed) {\n      console.log(`Gitleaks is installed: ${getGitleaksVersion()}`);\n      process.exit(0);\n    } else {\n      console.error(\"Gitleaks is not installed.\");\n      console.error(\"Install with: brew install gitleaks\");\n      process.exit(2);\n    }\n  }\n\n  // Verify gitleaks is installed\n  if (!checkGitleaksInstalled()) {\n    console.error(\"Error: Gitleaks is not installed.\");\n    console.error(\"\");\n    console.error(\"Install gitleaks:\");\n    console.error(\"  macOS:  brew install gitleaks\");\n    console.error(\"  Go:     go install github.com/gitleaks/gitleaks/v8@latest\");\n    console.error(\"  Docker: docker pull zricethezav/gitleaks\");\n    process.exit(2);\n  }\n\n  // Verify path exists\n  if (!existsSync(options.path)) {\n    console.error(`Error: Path not found: ${options.path}`);\n    process.exit(2);\n  }\n\n  try {\n    if (options.verbose) {\n      console.error(`Scanning ${options.path} for secrets...`);\n    }\n\n    const gitleaksFindings = await runGitleaks(options.path);\n    const findings = transformFindings(gitleaksFindings);\n\n    const result: ScanResult = {\n      tool: \"gitleaks\",\n      version: getGitleaksVersion(),\n      scanPath: options.path,\n      scanDate: new Date().toISOString(),\n      findings,\n      summary: calculateSummary(findings),\n    };\n\n    if (options.json) {\n      console.log(JSON.stringify(result, null, 2));\n    } else {\n      console.log(formatTextOutput(result));\n    }\n\n    // Exit with code 1 if secrets found\n    if (result.summary.total > 0) {\n      process.exit(1);\n    }\n  } catch (err) {\n    console.error(`Error: ${err instanceof Error ? err.message : String(err)}`);\n    process.exit(2);\n  }\n}\n\nmain();\n"],"mappings":"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"}