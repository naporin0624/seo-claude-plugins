{"version":3,"file":"index.js","names":["targetPath: string","severity: string","npmResult: NpmAuditResult","scanPath: string","findings: ScaFinding[]","trivyResult: TrivyResult","cvss: number | undefined","verbose: boolean","data: Buffer","result: ScanResult","options: CliOptions","scanner: ScannerType | null"],"sources":["../src/index.ts"],"sourcesContent":["#!/usr/bin/env node\n\nimport { spawn, spawnSync } from \"node:child_process\";\nimport { existsSync } from \"node:fs\";\nimport { join } from \"node:path\";\nimport { parseArgs } from \"node:util\";\nimport type {\n  CliOptions,\n  NpmAuditResult,\n  NpmVulnerabilityDetail,\n  ScaFinding,\n  ScanResult,\n  ScannerType,\n  TrivyResult,\n} from \"./types.js\";\n\nfunction checkNpmInstalled(): boolean {\n  try {\n    const result = spawnSync(\"npm\", [\"--version\"], {\n      encoding: \"utf-8\",\n      stdio: [\"pipe\", \"pipe\", \"pipe\"],\n    });\n    return result.status === 0;\n  } catch {\n    return false;\n  }\n}\n\nfunction checkTrivyInstalled(): boolean {\n  try {\n    const result = spawnSync(\"trivy\", [\"--version\"], {\n      encoding: \"utf-8\",\n      stdio: [\"pipe\", \"pipe\", \"pipe\"],\n    });\n    return result.status === 0;\n  } catch {\n    return false;\n  }\n}\n\nfunction getTrivyVersion(): string {\n  try {\n    const result = spawnSync(\"trivy\", [\"--version\"], {\n      encoding: \"utf-8\",\n      stdio: [\"pipe\", \"pipe\", \"pipe\"],\n    });\n    const match = result.stdout?.match(/Version:\\s*(\\S+)/);\n    return match?.[1] || \"unknown\";\n  } catch {\n    return \"unknown\";\n  }\n}\n\nfunction getNpmVersion(): string {\n  try {\n    const result = spawnSync(\"npm\", [\"--version\"], {\n      encoding: \"utf-8\",\n      stdio: [\"pipe\", \"pipe\", \"pipe\"],\n    });\n    return result.stdout?.trim() || \"unknown\";\n  } catch {\n    return \"unknown\";\n  }\n}\n\nfunction detectScanner(targetPath: string): ScannerType | null {\n  // Prefer Trivy if available (supports more languages)\n  if (checkTrivyInstalled()) {\n    return \"trivy\";\n  }\n\n  // Fall back to npm audit if package-lock.json exists\n  const hasPackageLock =\n    existsSync(join(targetPath, \"package-lock.json\")) ||\n    existsSync(targetPath) && targetPath.endsWith(\"package-lock.json\");\n\n  if (hasPackageLock && checkNpmInstalled()) {\n    return \"npm\";\n  }\n\n  return null;\n}\n\nfunction mapNpmSeverity(\n  severity: string\n): \"critical\" | \"high\" | \"medium\" | \"low\" | \"info\" {\n  switch (severity.toLowerCase()) {\n    case \"critical\":\n      return \"critical\";\n    case \"high\":\n      return \"high\";\n    case \"moderate\":\n      return \"medium\";\n    case \"low\":\n      return \"low\";\n    default:\n      return \"info\";\n  }\n}\n\nfunction mapTrivySeverity(\n  severity: string\n): \"critical\" | \"high\" | \"medium\" | \"low\" | \"info\" {\n  switch (severity.toUpperCase()) {\n    case \"CRITICAL\":\n      return \"critical\";\n    case \"HIGH\":\n      return \"high\";\n    case \"MEDIUM\":\n      return \"medium\";\n    case \"LOW\":\n      return \"low\";\n    default:\n      return \"info\";\n  }\n}\n\nfunction transformNpmResult(\n  npmResult: NpmAuditResult,\n  scanPath: string\n): ScanResult {\n  const findings: ScaFinding[] = [];\n\n  for (const [pkgName, vuln] of Object.entries(npmResult.vulnerabilities)) {\n    // Get detailed vulnerability info from 'via' field\n    const details = vuln.via.filter(\n      (v): v is NpmVulnerabilityDetail => typeof v !== \"string\"\n    );\n\n    for (const detail of details) {\n      findings.push({\n        id: detail.url?.split(\"/\").pop() || `npm-${detail.source}`,\n        severity: mapNpmSeverity(detail.severity),\n        package: pkgName,\n        installedVersion: vuln.range,\n        fixedVersion:\n          typeof vuln.fixAvailable === \"object\"\n            ? vuln.fixAvailable.version\n            : undefined,\n        title: detail.title,\n        description: undefined,\n        cvss: detail.cvss?.score,\n        cwes: detail.cwe || [],\n        references: detail.url ? [detail.url] : [],\n      });\n    }\n\n    // If no details, create a basic finding\n    if (details.length === 0) {\n      findings.push({\n        id: `npm-${pkgName}`,\n        severity: mapNpmSeverity(vuln.severity),\n        package: pkgName,\n        installedVersion: vuln.range,\n        fixedVersion:\n          typeof vuln.fixAvailable === \"object\"\n            ? vuln.fixAvailable.version\n            : undefined,\n        title: `Vulnerability in ${pkgName}`,\n        cwes: [],\n        references: [],\n      });\n    }\n  }\n\n  const meta = npmResult.metadata.vulnerabilities;\n  return {\n    tool: \"npm-audit\",\n    version: getNpmVersion(),\n    scanPath,\n    scanDate: new Date().toISOString(),\n    findings,\n    summary: {\n      total: meta.total,\n      critical: meta.critical,\n      high: meta.high,\n      medium: meta.moderate,\n      low: meta.low,\n      info: meta.info,\n    },\n  };\n}\n\nfunction transformTrivyResult(\n  trivyResult: TrivyResult,\n  scanPath: string\n): ScanResult {\n  const findings: ScaFinding[] = [];\n\n  for (const target of trivyResult.Results || []) {\n    for (const vuln of target.Vulnerabilities || []) {\n      // Get CVSS score from any available source\n      let cvss: number | undefined;\n      if (vuln.CVSS) {\n        for (const source of Object.values(vuln.CVSS)) {\n          if (source.V3Score) {\n            cvss = source.V3Score;\n            break;\n          }\n        }\n      }\n\n      findings.push({\n        id: vuln.VulnerabilityID,\n        severity: mapTrivySeverity(vuln.Severity),\n        package: vuln.PkgName,\n        installedVersion: vuln.InstalledVersion,\n        fixedVersion: vuln.FixedVersion,\n        title: vuln.Title || vuln.VulnerabilityID,\n        description: vuln.Description,\n        cvss,\n        cwes: vuln.CweIDs || [],\n        references: vuln.References || [],\n      });\n    }\n  }\n\n  const summary = {\n    total: findings.length,\n    critical: findings.filter((f) => f.severity === \"critical\").length,\n    high: findings.filter((f) => f.severity === \"high\").length,\n    medium: findings.filter((f) => f.severity === \"medium\").length,\n    low: findings.filter((f) => f.severity === \"low\").length,\n    info: findings.filter((f) => f.severity === \"info\").length,\n  };\n\n  return {\n    tool: \"trivy\",\n    version: getTrivyVersion(),\n    scanPath,\n    scanDate: new Date().toISOString(),\n    findings,\n    summary,\n  };\n}\n\nasync function runNpmAudit(\n  targetPath: string,\n  verbose: boolean\n): Promise<NpmAuditResult> {\n  return new Promise((resolve, reject) => {\n    const args = [\"audit\", \"--json\"];\n\n    if (verbose) {\n      console.error(`Running: npm ${args.join(\" \")} in ${targetPath}`);\n    }\n\n    const proc = spawn(\"npm\", args, {\n      cwd: targetPath,\n      stdio: [\"pipe\", \"pipe\", \"pipe\"],\n    });\n\n    let stdout = \"\";\n    let stderr = \"\";\n\n    proc.stdout.on(\"data\", (data: Buffer) => {\n      stdout += data.toString();\n    });\n\n    proc.stderr.on(\"data\", (data: Buffer) => {\n      stderr += data.toString();\n    });\n\n    proc.on(\"close\", (code) => {\n      // npm audit exits with non-zero when vulnerabilities found\n      try {\n        const result = JSON.parse(stdout) as NpmAuditResult;\n        resolve(result);\n      } catch (e) {\n        reject(new Error(`Failed to parse npm audit output: ${e}\\n${stderr}`));\n      }\n    });\n\n    proc.on(\"error\", (err) => {\n      reject(new Error(`Failed to spawn npm: ${err.message}`));\n    });\n  });\n}\n\nasync function runTrivy(\n  targetPath: string,\n  verbose: boolean\n): Promise<TrivyResult> {\n  return new Promise((resolve, reject) => {\n    const args = [\"fs\", \"--format\", \"json\", \"--scanners\", \"vuln\", targetPath];\n\n    if (verbose) {\n      console.error(`Running: trivy ${args.join(\" \")}`);\n    }\n\n    const proc = spawn(\"trivy\", args, {\n      stdio: [\"pipe\", \"pipe\", \"pipe\"],\n    });\n\n    let stdout = \"\";\n    let stderr = \"\";\n\n    proc.stdout.on(\"data\", (data: Buffer) => {\n      stdout += data.toString();\n    });\n\n    proc.stderr.on(\"data\", (data: Buffer) => {\n      stderr += data.toString();\n    });\n\n    proc.on(\"close\", (code) => {\n      if (code === 0) {\n        try {\n          const result = JSON.parse(stdout) as TrivyResult;\n          resolve(result);\n        } catch (e) {\n          reject(new Error(`Failed to parse trivy output: ${e}`));\n        }\n      } else {\n        reject(new Error(`Trivy exited with code ${code}: ${stderr}`));\n      }\n    });\n\n    proc.on(\"error\", (err) => {\n      reject(new Error(`Failed to spawn trivy: ${err.message}`));\n    });\n  });\n}\n\nfunction printTextReport(result: ScanResult): void {\n  console.log(\"\\n=== SCA Scan Report ===\\n\");\n  console.log(`Tool: ${result.tool} (${result.version})`);\n  console.log(`Scan Path: ${result.scanPath}`);\n  console.log(`Date: ${result.scanDate}`);\n  console.log(\"\\n--- Summary ---\");\n  console.log(`Total: ${result.summary.total}`);\n  console.log(`  Critical: ${result.summary.critical}`);\n  console.log(`  High: ${result.summary.high}`);\n  console.log(`  Medium: ${result.summary.medium}`);\n  console.log(`  Low: ${result.summary.low}`);\n  console.log(`  Info: ${result.summary.info}`);\n\n  if (result.findings.length > 0) {\n    console.log(\"\\n--- Vulnerabilities ---\\n\");\n\n    const severityOrder = { critical: 0, high: 1, medium: 2, low: 3, info: 4 };\n    const sorted = [...result.findings].sort(\n      (a, b) => severityOrder[a.severity] - severityOrder[b.severity]\n    );\n\n    for (const finding of sorted) {\n      console.log(`[${finding.severity.toUpperCase()}] ${finding.id}`);\n      console.log(`  Package: ${finding.package}@${finding.installedVersion}`);\n      if (finding.fixedVersion) {\n        console.log(`  Fixed in: ${finding.fixedVersion}`);\n      }\n      console.log(`  Title: ${finding.title}`);\n      if (finding.cvss) {\n        console.log(`  CVSS: ${finding.cvss}`);\n      }\n      if (finding.cwes.length > 0) {\n        console.log(`  CWEs: ${finding.cwes.join(\", \")}`);\n      }\n      console.log(\"\");\n    }\n  } else {\n    console.log(\"\\nNo vulnerabilities found.\");\n  }\n}\n\nfunction printHelp(): void {\n  console.log(`\nsca-runner - Software Composition Analysis\n\nUsage:\n  sca-runner <path> [options]\n  sca-runner --check\n\nOptions:\n  --scanner, -s <type>  Scanner to use: auto, npm, trivy (default: auto)\n  --json, -j            Output as JSON\n  --check               Check available scanners\n  --verbose, -v         Verbose output\n  --help, -h            Show this help\n\nExamples:\n  sca-runner .                    # Scan current directory\n  sca-runner . --scanner npm      # Force npm audit\n  sca-runner . --scanner trivy    # Force trivy\n  sca-runner . --json             # JSON output\n`);\n}\n\nasync function main(): Promise<void> {\n  const { values, positionals } = parseArgs({\n    allowPositionals: true,\n    options: {\n      scanner: { type: \"string\", short: \"s\", default: \"auto\" },\n      json: { type: \"boolean\", short: \"j\", default: false },\n      check: { type: \"boolean\", default: false },\n      verbose: { type: \"boolean\", short: \"v\", default: false },\n      help: { type: \"boolean\", short: \"h\", default: false },\n    },\n  });\n\n  if (values.help) {\n    printHelp();\n    process.exit(0);\n  }\n\n  if (values.check) {\n    console.log(\"Available scanners:\");\n    console.log(`  npm audit: ${checkNpmInstalled() ? \"installed\" : \"not found\"}`);\n    console.log(`  trivy: ${checkTrivyInstalled() ? \"installed\" : \"not found\"}`);\n\n    if (!checkNpmInstalled() && !checkTrivyInstalled()) {\n      console.error(\"\\nNo scanners available. Install one of:\");\n      console.error(\"  npm (built-in with Node.js)\");\n      console.error(\"  trivy: brew install trivy\");\n      process.exit(2);\n    }\n    process.exit(0);\n  }\n\n  const targetPath = positionals[0] || \".\";\n\n  const options: CliOptions = {\n    path: targetPath,\n    scanner: (values.scanner || \"auto\") as \"auto\" | \"npm\" | \"trivy\",\n    json: values.json || false,\n    check: values.check || false,\n    verbose: values.verbose || false,\n  };\n\n  let scanner: ScannerType | null = null;\n\n  if (options.scanner === \"auto\") {\n    scanner = detectScanner(targetPath);\n    if (!scanner) {\n      console.error(\"Error: No suitable scanner found.\");\n      console.error(\"Run 'sca-runner --check' to see available scanners.\");\n      process.exit(2);\n    }\n  } else if (options.scanner === \"npm\") {\n    if (!checkNpmInstalled()) {\n      console.error(\"Error: npm is not installed.\");\n      process.exit(2);\n    }\n    scanner = \"npm\";\n  } else if (options.scanner === \"trivy\") {\n    if (!checkTrivyInstalled()) {\n      console.error(\"Error: trivy is not installed.\");\n      console.error(\"Install with: brew install trivy\");\n      process.exit(2);\n    }\n    scanner = \"trivy\";\n  }\n\n  try {\n    let result: ScanResult;\n\n    if (scanner === \"npm\") {\n      const npmResult = await runNpmAudit(targetPath, options.verbose);\n      result = transformNpmResult(npmResult, targetPath);\n    } else {\n      const trivyResult = await runTrivy(targetPath, options.verbose);\n      result = transformTrivyResult(trivyResult, targetPath);\n    }\n\n    if (options.json) {\n      console.log(JSON.stringify(result, null, 2));\n    } else {\n      printTextReport(result);\n    }\n\n    if (result.summary.total > 0) {\n      process.exit(1);\n    }\n    process.exit(0);\n  } catch (error) {\n    console.error(\n      `Error: ${error instanceof Error ? error.message : String(error)}`\n    );\n    process.exit(2);\n  }\n}\n\nmain();\n"],"mappings":"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"}